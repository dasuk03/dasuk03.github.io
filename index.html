<!DOCTYPE html>
<html lang="ru">
<head>
  <script src="https://telegram.org/js/telegram-web-app.js "></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
  <title>–ö–æ—Å–º–æ–∑–∞—Ä ‚Äî –£—á—ë—Ç –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
      --bg-light: #ffffff; /* –ë–µ–ª—ã–π —Ñ–æ–Ω */
      --card-bg-light: #f5f5f5; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
      --text-light: #1a1a1a; /* –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
      --text-secondary-light: #666666; /* –ë–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π —Å–µ—Ä—ã–π –¥–ª—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
      --border-light: #cccccc; /* –°–µ—Ä–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);

      /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã */
      --bg-dark: #1a1a1a; /* –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π/—á—ë—Ä–Ω—ã–π —Ñ–æ–Ω */
      --card-bg-dark: #2e2e2e; /* –°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
      --text-dark: #e6e6e6; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
      --text-secondary-dark: #999999; /* –ë–æ–ª–µ–µ —Ç—É—Å–∫–ª—ã–π —Å–µ—Ä—ã–π –¥–ª—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
      --border-dark: #444444; /* –¢—ë–º–Ω–æ-—Å–µ—Ä–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
      --shadow-dark: 0 4px 12px rgba(0, 0, 0, 0.2);

      /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã */
      --bg: var(--bg-light);
      --card-bg: var(--card-bg-light);
      --text: var(--text-light);
      --text-secondary: var(--text-secondary-light);
      --border: var(--border-light);
      --shadow: var(--shadow-light);

      /* –ú–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –∫–Ω–æ–ø–æ–∫ */
      --status-ok-bg-light: rgba(0, 0, 0, 0.1); /* –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è OK –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-ok-text-light: #000000; /* –ß—ë—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è OK –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-bad-bg-light: rgba(0, 0, 0, 0.15); /* –ë–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π —Å–µ—Ä—ã–π –¥–ª—è Bad –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-bad-text-light: #000000; /* –ß—ë—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Bad –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-na-bg-light: rgba(0, 0, 0, 0.05); /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π –¥–ª—è NA –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-na-text-light: #666666; /* –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è NA –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-repair-bg-light: rgba(0, 0, 0, 0.08); /* –°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è Repair –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
      --status-repair-text-light: #333333; /* –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Repair –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */

      --status-ok-bg-dark: rgba(255, 255, 255, 0.1); /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è OK –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-ok-text-dark: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è OK –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-bad-bg-dark: rgba(255, 255, 255, 0.15); /* –ë–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π —Å–µ—Ä—ã–π –¥–ª—è Bad –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-bad-text-dark: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Bad –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-na-bg-dark: rgba(255, 255, 255, 0.05); /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è NA –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-na-text-dark: #999999; /* –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è NA –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-repair-bg-dark: rgba(255, 255, 255, 0.08); /* –°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è Repair –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
      --status-repair-text-dark: #cccccc; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Repair –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */

      --status-ok-bg: var(--status-ok-bg-light);
      --status-ok-text: var(--status-ok-text-light);
      --status-bad-bg: var(--status-bad-bg-light);
      --status-bad-text: var(--status-bad-text-light);
      --status-na-bg: var(--status-na-bg-light);
      --status-na-text: var(--status-na-text-light);
      --status-repair-bg: var(--status-repair-bg-light);
      --status-repair-text: var(--status-repair-text-light);

      /* –ö–Ω–æ–ø–∫–∏ */
      --btn-primary-bg: #000000; /* –ß—ë—Ä–Ω—ã–π */
      --btn-primary-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
      --btn-secondary-bg: #666666; /* –°–µ—Ä—ã–π */
      --btn-secondary-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
      --btn-accent-bg: #333333; /* –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π */
      --btn-accent-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
      --btn-export-bg: #444444; /* –°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π */
      --btn-export-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
      --btn-config-bg: var(--border); /* –ö–∞–∫ –≥—Ä–∞–Ω–∏—Ü–∞ */
      --btn-config-text: var(--text-secondary);
      --btn-delete-bg: #222222; /* –û—á–µ–Ω—å —Ç—ë–º–Ω—ã–π —Å–µ—Ä—ã–π */
      --btn-delete-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
      --btn-check-bg: #000000; /* –ß—ë—Ä–Ω—ã–π */
      --btn-check-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
      --btn-repair-bg: #555555; /* –°—Ä–µ–¥–Ω–µ-—Å–µ—Ä—ã–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–µ–º–æ–Ω—Ç–∞ */
      --btn-repair-text: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–µ–º–æ–Ω—Ç–∞ */

      --safe-area-top: env(safe-area-inset-top, 20px);
      --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    }

    /* –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã */
    .theme-dark {
      --bg: var(--bg-dark);
      --card-bg: var(--card-bg-dark);
      --text: var(--text-dark);
      --text-secondary: var(--text-secondary-dark);
      --border: var(--border-dark);
      --shadow: var(--shadow-dark);

      --status-ok-bg: var(--status-ok-bg-dark);
      --status-ok-text: var(--status-ok-text-dark);
      --status-bad-bg: var(--status-bad-bg-dark);
      --status-bad-text: var(--status-bad-text-dark);
      --status-na-bg: var(--status-na-bg-dark);
      --status-na-text: var(--status-na-text-dark);
      --status-repair-bg: var(--status-repair-bg-dark);
      --status-repair-text: var(--status-repair-text-dark);
    }

    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
      min-height: 100vh;
      padding: calc(var(--safe-area-top) + 12px) 16px var(--safe-area-bottom);
    }
    .container {
      max-width: 100%;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    header {
      padding: 24px 20px 16px;
      text-align: center;
      position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
    }
    h1 {
      margin: 0;
      font-size: 1.5em;
      font-weight: 600;
      color: var(--text);
    }
    .subtitle {
      font-size: 0.9em;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    .content {
      padding: 16px;
    }
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 16px;
      font-size: 1.1em;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 12px;
      transition: 0.2s;
      color: var(--btn-primary-text);
      text-align: center;
    }
    .btn-yellow { background: var(--btn-secondary-bg); color: var(--btn-secondary-text); }
    .btn-green { background: var(--btn-accent-bg); color: var(--btn-accent-text); }
    .btn-orange { background: var(--btn-secondary-bg); color: var(--btn-secondary-text); }
    .btn-accent { background: var(--btn-accent-bg); color: var(--btn-accent-text); }
    .btn-red { background: var(--btn-delete-bg); color: var(--btn-delete-text); }
    .btn-export-csv { background: var(--btn-export-bg); color: var(--btn-export-text); }
    .btn-settings {
        background: var(--btn-config-bg);
        color: var(--btn-config-text);
        width: auto;
        padding: 8px 12px;
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 1.2em;
        border: none;
        border-radius: 50%;
        cursor: pointer;
    }
    .btn-repair { background: var(--btn-repair-bg); color: var(--btn-repair-text); }
    .btn:hover:not(:disabled) {
      opacity: 0.9;
    }
    /* –°–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    .page {
      display: none;
    }
    .active {
      display: block;
    }
    /* –í–≤–æ–¥ ID */
    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .input-group input, .input-group select {
      padding: 14px 16px;
      border: 1px solid var(--border);
      border-radius: 16px;
      font-size: 1.1em;
      background: var(--card-bg);
      color: var(--text);
    }
    .input-group input {
      flex: 1;
      min-width: 80px;
      text-align: center;
    }
    .input-group select {
      flex: 2;
      min-width: 150px;
    }
    .input-group.full-width {
        flex-direction: column;
        gap: 12px;
    }
    .input-group.full-width input,
    .input-group.full-width select,
    .input-group.full-width textarea {
        width: 100%;
    }
    .input-group textarea {
        padding: 14px 16px;
        border: 1px solid var(--border);
        border-radius: 16px;
        font-size: 1.1em;
        background: var(--card-bg);
        color: var(--text);
        min-height: 80px;
        resize: vertical;
    }
    .input-label {
        font-weight: 500;
        margin-bottom: 4px;
        display: block;
    }
    .error {
      color: #ff3b30; /* –¶–≤–µ—Ç –æ—à–∏–±–∫–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å —Å–µ—Ä—ã–º */
      font-size: 0.95em;
      margin: 8px 0;
      text-align: center;
      min-height: 1.2em;
      height: 1.2em;
    }
    .kits, .players {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .kit, .player {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 16px;
    }
    .kit-header, .player-header {
      font-weight: 600;
      font-size: 1.1em;
      color: var(--text);
      margin: 0 0 12px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .kit-list, .player-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .kit-item, .player-item {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px 16px;
      margin-bottom: 10px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9em;
    }
    .kit-item-header, .player-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .kit-id, .player-id {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1.05em;
    }
    .gun { color: var(--text-secondary); } /* –°–¥–µ–ª–∞–µ–º —Ü–≤–µ—Ç –±–ª–∞—Å—Ç–µ—Ä–∞ —Å–µ—Ä—ã–º */
    .suit-red { color: var(--text-secondary); } /* –°–¥–µ–ª–∞–µ–º —Ü–≤–µ—Ç –∂–∏–ª–µ—Ç–∞ —Å–µ—Ä—ã–º */
    .suit-blue { color: var(--text-secondary); } /* –°–¥–µ–ª–∞–µ–º —Ü–≤–µ—Ç –∂–∏–ª–µ—Ç–∞ —Å–µ—Ä—ã–º */
    .btn-config, .btn-delete, .btn-check, .btn-repair-kit {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 14px;
      background: var(--btn-config-bg);
      color: var(--btn-config-text);
      cursor: pointer;
      font-size: 1.1em;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .btn-delete { background: var(--btn-delete-bg); color: var(--btn-delete-text); }
    .btn-check { background: var(--btn-check-bg); color: var(--btn-check-text); }
    .btn-repair-kit { background: var(--btn-repair-bg); color: var(--btn-repair-text); } /* –ö–Ω–æ–ø–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ */
    /* –ß–µ–∫-–ª–∏—Å—Ç */
    .checklist {
      margin-top: 10px;
      font-size: 0.9em;
    }
    .check-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 8px 0;
    }
    .check-item label {
      flex: 1;
    }
    .check-item input {
      transform: scale(1.2);
      margin-top: 2px;
    }
    .status {
      font-weight: bold;
      margin-top: 10px;
      font-size: 1.1em;
      padding: 8px;
      border-radius: 12px;
      text-align: center;
    }
    .status-ok {
      background-color: var(--status-ok-bg);
      color: var(--status-ok-text);
    }
    .status-bad {
      background-color: var(--status-bad-bg);
      color: var(--status-bad-text);
    }
    .status-na {
       background-color: var(--status-na-bg);
       color: var(--status-na-text);
    }
    .status-repair {
       background-color: var(--status-repair-bg);
       color: var(--status-repair-text);
    }
    .footer {
      text-align: center;
      padding: 20px 16px 30px;
      font-size: 0.8em;
      color: var(--text-secondary);
    }
    .back-btn {
      margin-bottom: 12px;
    }
    /* –°—Ç–∏–ª—å –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ */
    .additional-section {
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px dashed var(--border);
    }
    .additional-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }
    .kit-details, .player-details {
        font-size: 0.9em;
        color: var(--text-secondary);
        margin-top: 8px;
    }
    .dip-display {
        display: flex;
        gap: 5px;
        align-items: center;
        font-family: monospace;
    }
    .dip-label {
        font-weight: bold;
        min-width: 20px;
    }
    .dip-value-on { color: var(--text); } /* –¶–≤–µ—Ç –≤–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ DIP */
    .dip-value-off { color: var(--text-secondary); } /* –¶–≤–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ DIP */

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
    .settings-menu {
        position: absolute;
        top: 60px; /* –ù–∏–∂–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        right: 20px;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        box-shadow: var(--shadow);
        padding: 10px;
        z-index: 1000;
        min-width: 180px;
    }
    .settings-menu.hidden {
        display: none;
    }
    .settings-menu .btn {
        margin-bottom: 8px;
        font-size: 1em;
        padding: 12px;
        width: 100%; /* –ö–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ –º–µ–Ω—é –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
    }
    .settings-menu .btn:last-child {
        margin-bottom: 0;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ */
    .sort-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 16px;
    }
    .sort-btn {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border);
        background: var(--card-bg);
        color: var(--text);
        border-radius: 10px;
        cursor: pointer;
        text-align: center;
    }
    .sort-btn.active {
        background: var(--btn-accent-bg);
        color: var(--btn-accent-text);
        border-color: var(--btn-accent-bg);
    }
    /* === –ù–ê–ß–ê–õ–û: –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–º–æ–Ω—Ç–∞ === */
    .repair-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 16px;
    }
    .repair-btn {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border);
        background: var(--card-bg);
        color: var(--text);
        border-radius: 10px;
        cursor: pointer;
        text-align: center;
    }
    .repair-btn.active {
        background: var(--btn-accent-bg);
        color: var(--btn-accent-text);
        border-color: var(--btn-accent-bg);
    }
    .repair-report {
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid var(--border);
    }
    .repair-comment {
        margin-top: 10px;
        padding: 8px;
        background: var(--card-bg);
        border-radius: 8px;
        border: 1px solid var(--border);
        white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ */
    }
    .repair-image {
        margin-top: 10px;
        max-width: 100%;
        border-radius: 8px;
        border: 1px solid var(--border);
    }
    /* === –ö–û–ù–ï–¶: –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–º–æ–Ω—Ç–∞ === */
  </style>
</head>
<body>
  <!-- –ì–ª–∞–≤–Ω–∞—è: –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è -->
  <div id="home" class="page active container">
    <header>
      <h1>üéØ –ö–æ—Å–º–æ–∑–∞—Ä</h1>
      <div class="subtitle">–£—á—ë—Ç –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</div>
      <button class="btn btn-settings" onclick="toggleSettingsMenu()">‚öôÔ∏è</button>
      <div id="settingsMenu" class="settings-menu hidden">
        <button class="btn btn-orange" onclick="showPage('players'); toggleSettingsMenu();">üë• –ò–≥—Ä–æ–∫–∏ (DIP)</button>
        <button class="btn btn-accent" onclick="toggleTheme(); toggleSettingsMenu();">üåô/‚òÄÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
      </div>
    </header>
    <div class="content">
      <div class="input-group">
        <select id="currentBranchSelect" onchange="changeBranch(this.value)">
          <option value="reutov">üè¢ –†–µ—É—Ç–æ–≤</option>
          <option value="vdnh">üè¢ –í–æ–¥–Ω—ã–π –°—Ç–∞–¥–∏–æ–Ω</option>
          <option value="rostokino">üè¢ –†–æ—Å—Ç–æ–∫–∏–Ω–æ</option>
        </select>
      </div>
      <button class="btn btn-accent" onclick="showPage('kits')">üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</button>
      <button class="btn btn-repair" onclick="showPage('repair')">üîß –†–µ–º–æ–Ω—Ç</button> <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê -->
      <button class="btn btn-green" onclick="showPage('addKit')">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç</button>
      <button class="btn btn-export-csv" onclick="exportToCSV()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
    </div>
    <div class="footer">–°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ ‚Ä¢ v3.2</div>
  </div>

  <!-- –í—ã–±–æ—Ä —Ñ–∏–ª–∏–∞–ª–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞) -->
  <div id="branchSelect" class="page container">
    <header>
      <h1>üè¢ –í—ã–±–æ—Ä —Ñ–∏–ª–∏–∞–ª–∞</h1>
      <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª–∏–∞–ª</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥</button>
      <button class="btn btn-yellow" onclick="setBranch('reutov')">üè¢ –†–µ—É—Ç–æ–≤</button>
      <button class="btn btn-green" onclick="setBranch('vdnh')">üè¢ –í–æ–¥–Ω—ã–π –°—Ç–∞–¥–∏–æ–Ω</button>
      <button class="btn btn-orange" onclick="setBranch('rostokino')">üè¢ –†–æ—Å—Ç–æ–∫–∏–Ω–æ</button>
    </div>
    <div class="footer">–¢–µ–∫—É—â–∏–π —Ñ–∏–ª–∏–∞–ª: <span id="currentBranchFooter">–†–µ—É—Ç–æ–≤</span></div>
  </div>

  <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤ -->
  <div id="kits" class="page container">
    <header>
      <h1>üìã –ö–æ–º–ø–ª–µ–∫—Ç—ã</h1>
      <div class="subtitle">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤ (<span id="currentBranchKits"></span>)</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="sort-controls">
        <button class="sort-btn" id="sortAscBtn" onclick="setSortOrder('asc')">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</button>
        <button class="sort-btn" id="sortDescBtn" onclick="setSortOrder('desc')">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É–±—ã–≤–∞–Ω–∏—é</button>
      </div>
      <div class="kits">
        <div class="kit">
          <div class="kit-header">üõ°Ô∏è –ö–æ–º–ø–ª–µ–∫—Ç—ã</div>
          <ul id="allKitsList" class="kit-list"></ul>
        </div>
      </div>
    </div>
    <div class="footer">–£—á—ë—Ç –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</div>
  </div>

  <!-- === –ù–ê–ß–ê–õ–û: –ù–û–í–ê–Ø –°–¢–†–ê–ù–ò–¶–ê: –†–µ–º–æ–Ω—Ç === -->
  <div id="repair" class="page container">
    <header>
      <h1>üîß –†–µ–º–æ–Ω—Ç</h1>
      <div class="subtitle">–ö–æ–º–ø–ª–µ–∫—Ç—ã –≤ —Ä–µ–º–æ–Ω—Ç–µ (<span id="currentBranchRepair"></span>)</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="repair-controls">
        <button class="repair-btn" id="repairAllBtn" onclick="setRepairFilter('all')">–í—Å–µ</button>
        <button class="repair-btn" id="repairActiveBtn" onclick="setRepairFilter('active')">–í —Ä–µ–º–æ–Ω—Ç–µ</button>
      </div>
      <div class="kits">
        <div class="kit">
          <div class="kit-header">üõ°Ô∏è –ö–æ–º–ø–ª–µ–∫—Ç—ã</div>
          <ul id="repairKitsList" class="kit-list"></ul>
        </div>
      </div>
    </div>
    <div class="footer">–£—á—ë—Ç —Ä–µ–º–æ–Ω—Ç–∞</div>
  </div>
  <!-- === –ö–û–ù–ï–¶: –ù–û–í–ê–Ø –°–¢–†–ê–ù–ò–¶–ê: –†–µ–º–æ–Ω—Ç === -->

  <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞ -->
  <div id="addKit" class="page container">
    <header>
      <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç</h1>
      <div class="subtitle">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (<span id="currentBranchAdd"></span>)</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥</button>

      <div class="input-group">
        <select id="newVestColor">
          <option value="–ö—Ä–∞—Å–Ω—ã–π">üî¥ –ö—Ä–∞—Å–Ω—ã–π</option>
          <option value="–°–∏–Ω–∏–π">üîµ –°–∏–Ω–∏–π</option>
        </select>
      </div>

      <div class="input-group">
        <input type="number" id="newBlasterID" min="1" max="99" placeholder="–ë–ª–∞—Å—Ç–µ—Ä ID" inputmode="numeric">
      </div>

      <div class="input-group full-width">
        <span class="input-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</span>
        <input type="text" id="employeeName" placeholder="–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞">
      </div>

      <div class="input-group full-width">
        <span class="input-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
        <textarea id="kitComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
      </div>

      <button class="btn btn-accent" onclick="createNewKit()">–°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      <div id="addError" class="error"></div>
    </div>
    <div class="footer">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Ç–∞</div>
  </div>

  <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–≥—Ä–æ–∫–æ–≤ (DIP) -->
  <div id="players" class="page container">
    <header>
      <h1>üë• –ò–≥—Ä–æ–∫–∏</h1>
      <div class="subtitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ DIP-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('home')">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="players">
        <div class="player">
          <div class="player-header">üéöÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ DIP</div>
          <ul id="allPlayersList" class="player-list"></ul>
        </div>
      </div>
    </div>
    <div class="footer">–ò–≥—Ä–æ–∫–∏ 1-30</div>
  </div>

  <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞ -->
  <div id="inspectKit" class="page container">
    <header>
      <h1>üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞</h1>
      <div class="subtitle" id="inspectKitSubtitle">ID: -</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('kits')">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="inspectKitDetails" class="kit-details"></div>
      <div class="checklist" id="inspectionChecklist">
        <!-- –ß–µ–∫–±–æ–∫—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      <div id="kitStatus" class="status status-na">–°—Ç–∞—Ç—É—Å: –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>

      <div class="input-group full-width" style="margin-top: 20px;">
        <span class="input-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span>
        <textarea id="inspectionComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≤–µ—Ä–∫–µ..."></textarea>
      </div>

      <button class="btn btn-green" onclick="saveInspection()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
      <div id="saveError" class="error"></div>
    </div>
    <div class="footer">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è</div>
  </div>

  <!-- === –ù–ê–ß–ê–õ–û: –ù–û–í–ê–Ø –°–¢–†–ê–ù–ò–¶–ê: –û—Ç—á—ë—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç—É === -->
  <div id="repairReport" class="page container">
    <header>
      <h1>üìù –û—Ç—á—ë—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç—É</h1>
      <div class="subtitle" id="repairReportSubtitle">ID: -</div>
    </header>
    <div class="content">
      <button class="btn back-btn" onclick="showPage('repair')">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="repairKitDetails" class="kit-details"></div>

      <div class="input-group full-width">
        <span class="input-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ä–µ–º–æ–Ω—Ç—É</span>
        <textarea id="repairComment" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É..."></textarea>
      </div>

      <div class="input-group full-width">
        <span class="input-label">–§–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
        <input type="file" id="repairImageInput" accept="image/*">
      </div>

      <button class="btn btn-accent" onclick="saveRepairReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
      <div id="repairSaveError" class="error"></div>
    </div>
    <div class="footer">–†–µ–º–æ–Ω—Ç –∫–æ–º–ø–ª–µ–∫—Ç–∞</div>
  </div>
  <!-- === –ö–û–ù–ï–¶: –ù–û–í–ê–Ø –°–¢–†–ê–ù–ò–¶–ê: –û—Ç—á—ë—Ç –ø–æ —Ä–µ–º–æ–Ω—Ç—É === -->

  <script>
    // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –§–ò–õ–ò–ê–õ–ê–ú–ò ===
    const BRANCHES = ['reutov', 'vdnh', 'rostokino'];
    const BRANCH_NAMES = {
        'reutov': '–†–µ—É—Ç–æ–≤',
        'vdnh': '–í–æ–¥–Ω—ã–π –°—Ç–∞–¥–∏–æ–Ω',
        'rostokino': '–†–æ—Å—Ç–æ–∫–∏–Ω–æ'
    };

    let currentBranch = localStorage.getItem('cosmozar-current-branch') || BRANCHES[0];

    // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ï–ú–û–ô ===
    const THEME_STORAGE_KEY = 'cosmozar-theme';
    let currentTheme = localStorage.getItem(THEME_STORAGE_KEY) || 'light';

    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('theme-dark');
        } else {
            document.body.classList.remove('theme-dark');
        }
    }

    function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        localStorage.setItem(THEME_STORAGE_KEY, currentTheme);
        applyTheme(currentTheme);
    }

    applyTheme(currentTheme);

    // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–†–¢–ò–†–û–í–ö–û–ô ===
    const SORT_STORAGE_KEY = 'cosmozar-sort-order';
    let currentSortOrder = localStorage.getItem(SORT_STORAGE_KEY) || 'asc';

    function setSortOrder(order) {
        if (order === 'asc' || order === 'desc') {
            currentSortOrder = order;
            localStorage.setItem(SORT_STORAGE_KEY, currentSortOrder);
            updateSortButtonUI();
            loadAllKitsUI(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫
            if (currentRepairFilter === 'active') {
                 loadRepairKitsUI(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞, –µ—Å–ª–∏ –ø–æ–∫–∞–∑–∞–Ω—ã "–≤ —Ä–µ–º–æ–Ω—Ç–µ"
            }
        }
    }

    function updateSortButtonUI() {
        document.getElementById('sortAscBtn').classList.toggle('active', currentSortOrder === 'asc');
        document.getElementById('sortDescBtn').classList.toggle('active', currentSortOrder === 'desc');
    }

    // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ú–û–ù–¢–û–ú ===
    const REPAIR_FILTER_STORAGE_KEY = 'cosmozar-repair-filter';
    let currentRepairFilter = localStorage.getItem(REPAIR_FILTER_STORAGE_KEY) || 'active'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–≤ —Ä–µ–º–æ–Ω—Ç–µ"

    function setRepairFilter(filter) {
        if (filter === 'all' || filter === 'active') {
            currentRepairFilter = filter;
            localStorage.setItem(REPAIR_FILTER_STORAGE_KEY, currentRepairFilter);
            updateRepairButtonUI();
            loadRepairKitsUI();
        }
    }

    function updateRepairButtonUI() {
        document.getElementById('repairAllBtn').classList.toggle('active', currentRepairFilter === 'all');
        document.getElementById('repairActiveBtn').classList.toggle('active', currentRepairFilter === 'active');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function toggleSettingsMenu() {
        const menu = document.getElementById('settingsMenu');
        menu.classList.toggle('hidden');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª–∏–∞–ª–∞ —á–µ—Ä–µ–∑ select
    function changeBranch(branchId) {
        if (BRANCHES.includes(branchId)) {
            currentBranch = branchId;
            localStorage.setItem('cosmozar-current-branch', currentBranch);
            updateBranchDisplays();
            loadAllKitsUI();
            loadRepairKitsUI(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–∏–ª–∏–∞–ª–∞ (—Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
    function setBranch(branchId) {
        if (BRANCHES.includes(branchId)) {
            currentBranch = branchId;
            localStorage.setItem('cosmozar-current-branch', currentBranch);
            updateBranchDisplays();
            showPage('home');
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
    function updateBranchDisplays() {
        const branchName = BRANCH_NAMES[currentBranch];
        document.getElementById('currentBranchSelect').value = currentBranch;
        document.getElementById('currentBranchFooter').textContent = branchName;
        document.getElementById('currentBranchKits').textContent = branchName;
        document.getElementById('currentBranchAdd').textContent = branchName;
        document.getElementById('currentBranchRepair').textContent = branchName; // –î–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–º–æ–Ω—Ç–∞
    }

    // === –ú–û–î–ï–õ–¨ –î–ê–ù–ù–´–• –° –§–ò–õ–ò–ê–õ–ê–ú–ò ===
    const KITS_STORAGE_KEY = 'cosmozar-kits-by-branch-v3_2';

    let allBranchKits = JSON.parse(localStorage.getItem(KITS_STORAGE_KEY)) || {};

    BRANCHES.forEach(branch => {
        if (!allBranchKits[branch]) {
            allBranchKits[branch] = [];
        }
    });

    function getCurrentBranchKits() {
        return allBranchKits[currentBranch] || [];
    }

    function saveAllBranchKits() {
        localStorage.setItem(KITS_STORAGE_KEY, JSON.stringify(allBranchKits));
    }

    // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ repair)
    function createKitSkeleton(vestColor, blasterId = null, employee = '', comment = '') {
        const now = new Date().toLocaleDateString('ru-RU');
        return {
            id: generateKitId(),
            vestColor: vestColor,
            blasterId: blasterId,
            status: "–ù–ê–î–û",
            isVestSuitable: true,
            checks: {
                vestHits: true,
                vestWire: true,
                vestVibro: true,
                vestLaser: true,
                vestSound: true,
                vestDisplay: true,
                vestSideStripes: true,
                vestBodyHalves: true,
                vestScrews: true,
                vestTrigger: true,
                vestSensorCover: true,
                vestNoCracks: true,
                vestStickers: true,
                vestBeltBuckles: true,
            },
            batteryType: "Li-ion",
            lastInspectionDate: now,
            employee: employee,
            comment: comment,
            // === –ù–û–í–û–ï: –ü–æ–ª–µ –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞ ===
            repair: {
                active: false,
                comment: '',
                image: null, // –ë—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å Data URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                lastRepairDate: null
            }
            // === –ö–û–ù–ï–¶: –ù–û–í–û–ï ===
        };
    }

    function generateKitId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
    }

    // === –°–¢–†–ê–ù–ò–¶–ê: –ü–†–û–°–ú–û–¢–† –ö–û–ú–ü–õ–ï–ö–¢–û–í ===
    function loadAllKitsUI() {
        const kits = getCurrentBranchKits();
        kits.sort((a, b) => {
            const idA = a.blasterId !== null ? a.blasterId : Infinity;
            const idB = b.blasterId !== null ? b.blasterId : Infinity;
            if (currentSortOrder === 'asc') {
                return idA - idB;
            } else {
                return idB - idA;
            }
        });
        const list = document.getElementById('allKitsList');
        list.innerHTML = '';
        if (kits.length === 0) {
            list.innerHTML = '<li class="kit-item" style="text-align:center;">–ù–µ—Ç –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</li>';
            return;
        }
        kits.forEach(kit => {
            const item = document.createElement('li');
            item.className = 'kit-item';

            let statusClass, statusText;
            if (kit.repair.active) {
                statusClass = 'status-repair';
                statusText = 'üîß –í —Ä–µ–º–æ–Ω—Ç–µ';
            } else {
                statusClass = kit.isVestSuitable ? 'status-ok' : 'status-bad';
                statusText = kit.isVestSuitable ? '‚úÖ –ü—Ä–∏–≥–æ–¥–µ–Ω' : '‚ùå –ù–µ –ø—Ä–∏–≥–æ–¥–µ–Ω';
            }

            const vestColorEmoji = kit.vestColor === '–ö—Ä–∞—Å–Ω—ã–π' ? 'üî¥' : 'üîµ';

            item.innerHTML = `
                <div class="kit-item-header">
                    <div class="kit-id">
                        <span>${vestColorEmoji}</span>
                        ${kit.vestColor} ${kit.blasterId !== null ? `| –ë–ª–∞—Å—Ç–µ—Ä: ${kit.blasterId}` : ''}
                    </div>
                    <div style="display:flex; gap: 8px;">
                        <button class="btn-check" onclick="inspectKit('${kit.id}')">üîß</button>
                        <!-- === –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–º–æ–Ω—Ç–∞ === -->
                        <button class="btn-repair-kit" onclick="toggleRepairStatus('${kit.id}')">${kit.repair.active ? '‚úÖ' : 'üîß'}</button>
                        <!-- === –ö–û–ù–ï–¶: –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê === -->
                        <button class="btn-delete" onclick="deleteKit('${kit.id}')">‚úï</button>
                    </div>
                </div>
                <div class="kit-details">
                    –î–∞—Ç–∞: ${kit.lastInspectionDate} | –°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${kit.employee || '-'}
                    ${kit.comment ? `<br>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${kit.comment}` : ''}
                </div>
                <div class="status ${statusClass}">${statusText}</div>
            `;
            list.appendChild(item);
        });
    }

    // === –§–£–ù–ö–¶–ò–Ø: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–º–æ–Ω—Ç–∞ ===
    function toggleRepairStatus(kitId) {
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === kitId);
        if (kit) {
            kit.repair.active = !kit.repair.active;
            if (kit.repair.active) {
                // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –≤–∫–ª—é—á—ë–Ω, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞
                kit.repair.lastRepairDate = null;
            }
            saveAllBranchKits();
            loadAllKitsUI(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫
            if (currentRepairFilter === 'active') {
                 loadRepairKitsUI(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞, –µ—Å–ª–∏ –ø–æ–∫–∞–∑–∞–Ω—ã "–≤ —Ä–µ–º–æ–Ω—Ç–µ"
            }
        }
    }


    // === –°–¢–†–ê–ù–ò–¶–ê: –†–ï–ú–û–ù–¢ ===
    function loadRepairKitsUI() {
        const kits = getCurrentBranchKits();
        // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Å—Ç–∞—Ç—É—Å—É —Ä–µ–º–æ–Ω—Ç–∞
        let filteredKits = kits;
        if (currentRepairFilter === 'active') {
            filteredKits = kits.filter(kit => kit.repair.active);
        }

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ blasterId
        filteredKits.sort((a, b) => {
            const idA = a.blasterId !== null ? a.blasterId : Infinity;
            const idB = b.blasterId !== null ? b.blasterId : Infinity;
            if (currentSortOrder === 'asc') {
                return idA - idB;
            } else {
                return idB - idA;
            }
        });

        const list = document.getElementById('repairKitsList');
        list.innerHTML = '';
        if (filteredKits.length === 0) {
            list.innerHTML = '<li class="kit-item" style="text-align:center;">–ù–µ—Ç –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤</li>';
            return;
        }
        filteredKits.forEach(kit => {
            const item = document.createElement('li');
            item.className = 'kit-item';

            // –°—Ç–∞—Ç—É—Å "–≤ —Ä–µ–º–æ–Ω—Ç–µ"
            const statusClass = 'status-repair';
            const statusText = 'üîß –í —Ä–µ–º–æ–Ω—Ç–µ';

            const vestColorEmoji = kit.vestColor === '–ö—Ä–∞—Å–Ω—ã–π' ? 'üî¥' : 'üîµ';

            item.innerHTML = `
                <div class="kit-item-header">
                    <div class="kit-id">
                        <span>${vestColorEmoji}</span>
                        ${kit.vestColor} ${kit.blasterId !== null ? `| –ë–ª–∞—Å—Ç–µ—Ä: ${kit.blasterId}` : ''}
                    </div>
                    <div style="display:flex; gap: 8px;">
                        <button class="btn-repair" onclick="reportRepair('${kit.id}')">üìù</button>
                    </div>
                </div>
                <div class="kit-details">
                    –î–∞—Ç–∞: ${kit.lastInspectionDate} | –°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${kit.employee || '-'}
                    ${kit.comment ? `<br>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${kit.comment}` : ''}
                </div>
                <div class="status ${statusClass}">${statusText}</div>
                <!-- === –û–¢–ß–Å–¢ –ü–û –†–ï–ú–û–ù–¢–£ === -->
                ${kit.repair.lastRepairDate ? `<div class="repair-report">
                    <div class="additional-title">–û—Ç—á—ë—Ç –æ —Ä–µ–º–æ–Ω—Ç–µ:</div>
                    <div class="kit-details">
                        –î–∞—Ç–∞: ${kit.repair.lastRepairDate}
                        ${kit.repair.comment ? `<div class="repair-comment">${kit.repair.comment}</div>` : ''}
                        ${kit.repair.image ? `<img src="${kit.repair.image}" alt="–§–æ—Ç–æ –ø–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞" class="repair-image">` : ''}
                    </div>
                </div>` : ''}
            `;
            list.appendChild(item);
        });
    }

    // === –°–¢–†–ê–ù–ò–¶–ê: –û–¢–ß–Å–¢ –ü–û –†–ï–ú–û–ù–¢–£ ===
    let currentRepairingKitId = null;

    function reportRepair(kitId) {
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === kitId);
        if (!kit) {
            alert('–ö–æ–º–ø–ª–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
            showPage('repair');
            return;
        }
        currentRepairingKitId = kitId;
        document.getElementById('repairReportSubtitle').textContent = `${kit.vestColor} ${kit.blasterId !== null ? `| –ë–ª–∞—Å—Ç–µ—Ä: ${kit.blasterId}` : ''}`;
        document.getElementById('repairKitDetails').innerHTML = `
            –¶–≤–µ—Ç: ${kit.vestColor} | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏: ${kit.lastInspectionDate} | –°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${kit.employee || '-'}
            ${kit.comment ? `<br>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${kit.comment}` : ''}
        `;
        document.getElementById('repairComment').value = kit.repair.comment || '';
        document.getElementById('repairImageInput').value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª

        showPage('repairReport');
    }

    function saveRepairReport() {
        if (!currentRepairingKitId) {
            document.getElementById('repairSaveError').textContent = '–û—à–∏–±–∫–∞: –∫–æ–º–ø–ª–µ–∫—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω';
            return;
        }
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === currentRepairingKitId);
        if (kit) {
            kit.repair.comment = document.getElementById('repairComment').value.trim();
            kit.repair.lastRepairDate = new Date().toLocaleDateString('ru-RU');

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const fileInput = document.getElementById('repairImageInput');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    kit.repair.image = e.target.result; // –°–æ—Ö—Ä–∞–Ω—è–µ–º Data URL
                    finalizeRepairSave(kit);
                };
                reader.readAsDataURL(file);
            } else {
                // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç
                kit.repair.image = null;
                finalizeRepairSave(kit);
            }
        }
    }

    function finalizeRepairSave(kit) {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Ä–µ–º–æ–Ω—Ç–∞
        kit.repair.active = false;
        saveAllBranchKits();
        loadRepairKitsUI(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞
        loadAllKitsUI(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫
        showPage('repair'); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–º–æ–Ω—Ç–∞
    }


    // === –°–¢–†–ê–ù–ò–¶–ê: –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–û–ú–ü–õ–ï–ö–¢–ê ===
    function createNewKit() {
        const vestColor = document.getElementById('newVestColor').value;
        const blasterId = document.getElementById('newBlasterID').value ? parseInt(document.getElementById('newBlasterID').value) : null;
        const employee = document.getElementById('employeeName').value.trim();
        const comment = document.getElementById('kitComment').value.trim();
        const error = document.getElementById('addError');
        error.textContent = '';

        const newKit = createKitSkeleton(vestColor, blasterId, employee, comment);

        allBranchKits[currentBranch].push(newKit);
        saveAllBranchKits();

        document.getElementById('newBlasterID').value = '';
        document.getElementById('employeeName').value = '';
        document.getElementById('kitComment').value = '';

        inspectKit(newKit.id);
    }

    // === –°–¢–†–ê–ù–ò–¶–ê: –ü–†–û–í–ï–†–ö–ê –ö–û–ú–ü–õ–ï–ö–¢–ê ===
    let currentInspectingKitId = null;
    function inspectKit(kitId) {
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === kitId);
        if (!kit) {
            alert('–ö–æ–º–ø–ª–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
            showPage('kits');
            return;
        }
        currentInspectingKitId = kitId;
        document.getElementById('inspectKitSubtitle').textContent = `${kit.vestColor} ${kit.blasterId !== null ? `| –ë–ª–∞—Å—Ç–µ—Ä: ${kit.blasterId}` : ''}`;
        document.getElementById('inspectKitDetails').innerHTML = `
            –¶–≤–µ—Ç: ${kit.vestColor} | –î–∞—Ç–∞: ${kit.lastInspectionDate} | –°–æ—Ç—Ä—É–¥–Ω–∏–∫: ${kit.employee || '-'}
            ${kit.comment ? `<br>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${kit.comment}` : ''}
        `;
        document.getElementById('inspectionComment').value = kit.comment || '';

        const checklist = document.getElementById('inspectionChecklist');
        checklist.innerHTML = '';

        const mainVestChecks = [
            { id: 'vestHits', label: '–ê–≤—Ç–æ–º–∞—Ç –ø–æ—Ä–∞–∂–∞–µ—Ç —Ü–µ–ª—å' },
            { id: 'vestWire', label: '–ü—Ä–æ–≤–æ–¥ –∞–≤—Ç–æ–º–∞—Ç –∂–∏–ª–µ—Ç —Ü–µ–ª, —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã –Ω–µ –º–µ—Ä—Ü–∞—é—Ç –ø—Ä–∏ –∏–∑–≥–∏–±–µ –ø—Ä–æ–≤–æ–¥–∞.' },
            { id: 'vestVibro', label: '–í–∏–±—Ä–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç' },
            { id: 'vestLaser', label: '–õ–∞–∑–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç' },
            { id: 'vestSound', label: '–ó–≤—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç' },
            { id: 'vestDisplay', label: '–†–∞–±–æ—Ç–∞—é—Ç –≤—Å–µ —Å–µ–∫—Ç–æ—Ä–∞ –¥–∏—Å–ø–ª–µ—è' }
        ];
        mainVestChecks.forEach(check => {
            const div = document.createElement('div');
            div.className = 'check-item';
            div.innerHTML = `
                <input type="checkbox" id="chk-${check.id}" ${kit.checks[check.id] ? 'checked' : ''} onchange="updateKitCheck('${check.id}', this.checked)">
                <label for="chk-${check.id}">${check.label}</label>
            `;
            checklist.appendChild(div);
        });

        const additionalVestChecks = [
            { id: 'vestSideStripes', label: '–¶–µ–ª—ã —Ü–≤–µ—Ç–Ω—ã–µ –ø–æ–ª–æ—Å—ã –ø–æ –±–æ–∫–∞–º –∞–≤—Ç–æ–º–∞—Ç–∞' },
            { id: 'vestBodyHalves', label: '–ü–æ–ª–æ–≤–∏–Ω–∫–∏ –∫–æ—Ä–ø—É—Å–∞ –ø–ª–æ—Ç–Ω–æ —Å—Ç—è–Ω—É—Ç—ã' },
            { id: 'vestScrews', label: '–í–∏–Ω—Ç—ã –µ—Å—Ç—å —Ç–∞–º –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ' },
            { id: 'vestTrigger', label: '–ö—É—Ä–æ–∫ –º—è–≥–∫–∏–π –∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É' },
            { id: 'vestSensorCover', label: '–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫—Ä—ã—à–∫–∏ –Ω–∞ –∂–∏–ª–µ—Ç–µ —Ü–µ–ª—ã, –±—É–º–∞–∂–Ω—ã–µ –≤–∫–ª–∞–¥—ã—à–∏ –≤—ã–≥–ª—è–¥—è—Ç —Ö–æ—Ä–æ—à–æ.' },
            { id: 'vestNoCracks', label: '–ù–∞ –ø–ª–∞—Å—Ç–∏–∫–µ –∂–∏–ª–µ—Ç–∞ –Ω–µ—Ç –Ω–µ–∑–∞—à–∏—Ç—ã—Ö —Ç—Ä–µ—â–∏–Ω' },
            { id: 'vestStickers', label: '–ù–∞–∫–ª–µ–π–∫–∏ –≤—ã–≥–ª—è–¥—è—Ç —Ö–æ—Ä–æ—à–æ' },
            { id: 'vestBeltBuckles', label: '–ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ –∑–∞—â—ë–ª–∫–∏ —Ä–µ–º–Ω–µ–π —Ü–µ–ª—ã' }
        ];
        const additionalSection = document.createElement('div');
        additionalSection.className = 'additional-section';
        additionalSection.innerHTML = '<div class="additional-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∂–∏–ª–µ—Ç–∞</div>';
        additionalVestChecks.forEach(check => {
            const div = document.createElement('div');
            div.className = 'check-item';
            div.innerHTML = `
                <input type="checkbox" id="chk-${check.id}" ${kit.checks[check.id] ? 'checked' : ''} onchange="updateKitCheck('${check.id}', this.checked)">
                <label for="chk-${check.id}">${check.label}</label>
            `;
            additionalSection.appendChild(div);
        });
        checklist.appendChild(additionalSection);
        updateKitStatusDisplay();
        showPage('inspectKit');
    }

    function updateKitCheck(field, isChecked) {
        if (!currentInspectingKitId) return;
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === currentInspectingKitId);
        if (kit) {
            kit.checks[field] = isChecked;
            const mainChecks = [
                kit.checks.vestHits,
                kit.checks.vestWire,
                kit.checks.vestVibro,
                kit.checks.vestLaser,
                kit.checks.vestSound,
                kit.checks.vestDisplay
            ];
            kit.isVestSuitable = mainChecks.every(v => v);
            updateKitStatusDisplay();
        }
    }

    function updateKitStatusDisplay() {
        if (!currentInspectingKitId) return;
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === currentInspectingKitId);
        if (kit) {
            const statusEl = document.getElementById('kitStatus');
            if (statusEl) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–º–æ–Ω—Ç–∞
                let statusClass, statusText;
                if (kit.repair.active) {
                    statusClass = 'status-repair';
                    statusText = 'üîß –í —Ä–µ–º–æ–Ω—Ç–µ';
                } else {
                    statusClass = kit.isVestSuitable ? 'status-ok' : 'status-bad';
                    statusText = kit.isVestSuitable ? '‚úÖ –ü—Ä–∏–≥–æ–¥–µ–Ω' : '‚ùå –ù–µ –ø—Ä–∏–≥–æ–¥–µ–Ω';
                }
                statusEl.className = `status ${statusClass}`;
                statusEl.textContent = statusText;
            }
        }
    }

    function saveInspection() {
        if (!currentInspectingKitId) {
            document.getElementById('saveError').textContent = '–û—à–∏–±–∫–∞: –∫–æ–º–ø–ª–µ–∫—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω';
            return;
        }
        const kits = getCurrentBranchKits();
        const kit = kits.find(k => k.id === currentInspectingKitId);
        if (kit) {
            kit.lastInspectionDate = new Date().toLocaleDateString('ru-RU');
            kit.comment = document.getElementById('inspectionComment').value.trim();
            saveAllBranchKits();
            loadAllKitsUI();
            showPage('kits');
        }
    }

    // === –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø ===
    function deleteKit(kitId) {
        const kits = getCurrentBranchKits();
        const kitToDelete = kits.find(k => k.id === kitId);
        if (!kitToDelete) {
            console.error('–ö–æ–º–ø–ª–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è, ID:', kitId);
            return;
        }

        const confirmationMessage = `–£–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç: ${kitToDelete.vestColor} ${kitToDelete.blasterId !== null ? `| –ë–ª–∞—Å—Ç–µ—Ä: ${kitToDelete.blasterId}` : ''}?`;

        if (confirm(confirmationMessage)) {
            allBranchKits[currentBranch] = kits.filter(k => k.id !== kitId);
            saveAllBranchKits();
            loadAllKitsUI();
            loadRepairKitsUI(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–µ–º–æ–Ω—Ç–∞
            if (currentInspectingKitId === kitId) {
                currentInspectingKitId = null;
            }
            if (currentRepairingKitId === kitId) {
                currentRepairingKitId = null;
            }
        }
    }

    // === –°–¢–†–ê–ù–ò–¶–ê: –ü–†–û–°–ú–û–¢–† –ò–ì–†–û–ö–û–í (DIP) ===
    function loadAllPlayersUI() {
        const list = document.getElementById('allPlayersList');
        list.innerHTML = '';

        for (let playerId = 1; playerId <= 30; playerId++) {
            const item = document.createElement('li');
            item.className = 'player-item';

            const dipBits = [];
            for (let i = 0; i < 5; i++) {
                const bitValue = (playerId >> i) & 1;
                dipBits.push(bitValue ? '+' : '‚Äì');
            }

            let dipDisplayHTML = '';
            for (let i = 0; i < 5; i++) {
                const label = i + 1;
                const value = dipBits[i];
                const valueClass = value === '+' ? 'dip-value-on' : 'dip-value-off';
                dipDisplayHTML += `<span class="dip-display"><span class="dip-label">–¢${label}:</span><span class="${valueClass}">${value}</span></span>`;
            }

            item.innerHTML = `
                <div class="player-item-header">
                    <div class="player-id">–ò–≥—Ä–æ–∫ ${playerId}</div>
                </div>
                <div class="player-details">
                    ${dipDisplayHTML}
                </div>
            `;
            list.appendChild(item);
        }
    }

    // === –≠–ö–°–ü–û–†–¢ –í CSV ===
    function exportToCSV() {
        const kits = getCurrentBranchKits();
        let csv = '';
        kits.forEach(kit => {
            const checks = [
                kit.checks.vestHits ? 'TRUE' : 'FALSE',
                kit.checks.vestWire ? 'TRUE' : 'FALSE',
                kit.checks.vestVibro ? 'TRUE' : 'FALSE',
                kit.checks.vestLaser ? 'TRUE' : 'FALSE',
                kit.checks.vestSound ? 'TRUE' : 'FALSE',
                kit.checks.vestDisplay ? 'TRUE' : 'FALSE',
                kit.checks.vestSideStripes ? 'TRUE' : 'FALSE',
                kit.checks.vestBodyHalves ? 'TRUE' : 'FALSE',
                kit.checks.vestScrews ? 'TRUE' : 'FALSE',
                kit.checks.vestTrigger ? 'TRUE' : 'FALSE',
                kit.checks.vestSensorCover ? 'TRUE' : 'FALSE',
                kit.checks.vestNoCracks ? 'TRUE' : 'FALSE',
                kit.checks.vestStickers ? 'TRUE' : 'FALSE',
                kit.checks.vestBeltBuckles ? 'TRUE' : 'FALSE'
            ];
            const extraData = [
                kit.lastInspectionDate || '',
                kit.employee || '',
                kit.comment || '',
                kit.repair.active ? '–í —Ä–µ–º–æ–Ω—Ç–µ' : '–ù–µ –≤ —Ä–µ–º–æ–Ω—Ç–µ', // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–µ–º–æ–Ω—Ç–∞ –≤ CSV
                kit.repair.comment || '', // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–º–æ–Ω—Ç–∞
                kit.repair.lastRepairDate || '' // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞
            ];
            const fullRow = checks.concat(extraData);
            csv += fullRow.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',') + '\n';
        });

        const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
        const supportsShare = navigator.share && navigator.canShare && navigator.canShare({ files: [new File([], 'test')] });
        if (supportsShare) {
            const file = new File([blob], `cosmozar-export-${currentBranch}.csv`, { type: 'text/csv' });
            navigator.share({
                title: '–≠–∫—Å–ø–æ—Ä—Ç Cosmozar',
                text: `–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤ (${BRANCH_NAMES[currentBranch]})`,
                files: [file]
            }).catch(error => {
                console.log('Share failed:', error.message);
                triggerDownload(blob, `cosmozar-export-${currentBranch}.csv`);
            });
        } else {
            triggerDownload(blob, `cosmozar-export-${currentBranch}.csv`);
        }
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ "–∫–ª–∏–∫–∞" –ø–æ —Å—Å—ã–ª–∫–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    function triggerDownload(blob, filename = 'cosmozar-export.csv') {
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        if (/Mobi|Android/i.test(navigator.userAgent)) {
            link.style.position = 'fixed';
            link.style.top = '50%';
            link.style.left = '50%';
            link.style.transform = 'translate(-50%, -50%)';
            link.style.padding = '20px';
            link.style.fontSize = '18px';
            link.style.zIndex = '10000';
            link.style.background = '#0077ff';
            link.style.color = 'white';
            link.style.borderRadius = '10px';
            link.style.textDecoration = 'none';
            link.textContent = '–°–∫–∞—á–∞—Ç—å CSV';
            link.target = '_blank';

            const closeBtn = document.createElement('button');
            closeBtn.textContent = '√ó';
            closeBtn.style.position = 'absolute';
            closeBtn.style.top = '5px';
            closeBtn.style.right = '10px';
            closeBtn.style.background = 'none';
            closeBtn.style.border = 'none';
            closeBtn.style.color = 'white';
            closeBtn.style.fontSize = '24px';
            closeBtn.style.cursor = 'pointer';
            closeBtn.onclick = function(e) {
                e.stopPropagation();
                document.body.removeChild(link);
            };
            link.appendChild(closeBtn);
            document.body.appendChild(link);

            setTimeout(() => {
                if (document.body.contains(link)) {
                    document.body.removeChild(link);
                }
            }, 10000);
        } else {
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        setTimeout(() => URL.revokeObjectURL(url), 100);
    }

     // === –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ù–ê–í–ò–ì–ê–¶–ò–ò ===
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const page = document.getElementById(pageId);
      if (page) {
        page.classList.add('active');
      }
      document.getElementById('settingsMenu').classList.add('hidden');
    }

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    window.onload = () => {
        updateBranchDisplays();
        updateSortButtonUI();
        updateRepairButtonUI(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–º–æ–Ω—Ç–∞
        loadAllKitsUI();
        loadRepairKitsUI(); // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ä–µ–º–æ–Ω—Ç–∞
        loadAllPlayersUI();
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function(event) {
        const menu = document.getElementById('settingsMenu');
        const settingsBtn = document.querySelector('.btn-settings');
        if (menu && !menu.classList.contains('hidden') &&
            !menu.contains(event.target) &&
            event.target !== settingsBtn) {
            menu.classList.add('hidden');
        }
    });
  </script>
</body>

</html>