<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmozar - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</title>
<style>
:root {
  --bg: #f5f5f5;
  --card-bg: #ffffff;
  --text: #111111;
  --text-secondary: #888888;
  --accent: #444444;
  --border: #dddddd;
  --green: #28a745;
  --red: #e63946;
  --blue: #1d3557;
  --safe-area-top: env(safe-area-inset-top, 20px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
}

[data-theme="dark"] {
  --bg: #1c1c1e;
  --card-bg: #2a2a2c;
  --text: #f5f5f7;
  --text-secondary: #8e8e93;
  --border: #3a3a3c;
  --accent: #555555;
}

body {
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  overflow-x: hidden;
}

.container {
  padding: calc(var(--safe-area-top) + 10px) 20px calc(var(--safe-area-bottom) + 20px);
}

.tabs {
  display: flex;
  justify-content: space-around;
  background: var(--card-bg);
  padding: 10px;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 10;
}

.tab {
  padding: 10px 15px;
  cursor: pointer;
  font-weight: bold;
  color: var(--text-secondary);
  border-bottom: 2px solid transparent;
}

.tab.active {
  color: var(--accent);
  border-color: var(--accent);
}

.kit {
  background: var(--card-bg);
  margin: 15px 0;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid var(--border);
}

.kit-header {
  font-size: 18px;
  margin-bottom: 5px;
  display: flex;
  align-items: center;
}

.status {
  font-weight: bold;
}

.available { color: var(--green); }
.used { color: var(--red); }

.btn {
  padding: 8px 12px;
  border-radius: 6px;
  background: var(--accent);
  color: white;
  font-weight: bold;
  border: none;
  cursor: pointer;
  margin: 5px 0;
}

.btn-green { background: var(--green); }
.btn-red { background: var(--red); }
.btn-orange { background: #ff9933; }

.hidden { display: none; }

.settings-menu {
  position: fixed;
  right: 15px;
  top: 60px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px;
  z-index: 20;
}
</style>
</head>

<body>
<div class="tabs">
  <div class="tab active" onclick="showPage('kits')">–ö–æ–º–ø–ª–µ–∫—Ç—ã</div>
  <div class="tab" onclick="showPage('blasters')">–ë–ª–∞—Å—Ç–µ—Ä—ã</div>
  <div class="tab" onclick="showPage('players')">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
  <div class="tab" onclick="showPage('settings')">‚öôÔ∏è</div>
</div>

<div class="container">

<div id="kits" class="page">
  <div class="kit">
    <div class="kit-header">
      üõ°Ô∏è –ö–æ–º–ø–ª–µ–∫—Ç—ã
      <button style="margin-left:auto" onclick="sortKitsAsc()">‚Üë</button>
      <button onclick="sortKitsDesc()">‚Üì</button>
    </div>
    <div id="kitList"></div>
    <button class="btn btn-green" onclick="createNewKit()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç</button>
  </div>
</div>

<div id="blasters" class="page hidden">
  <div class="kit-header">üî´ –ë–ª–∞—Å—Ç–µ—Ä—ã</div>
  <div id="blasterList"></div>
</div>

<div id="players" class="page hidden">
  <div class="kit-header">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
  <div id="playerList"></div>
</div>

<div id="settings" class="page hidden">
  <div class="kit-header">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
  <button class="btn btn-orange" onclick="toggleSettingsMenu()">–ú–µ–Ω—é</button>
</div>

<div id="settingsMenu" class="settings-menu hidden">
  <button class="btn btn-orange" onclick="toggleTheme()">üåì –¢–µ–º–∞</button>
  <button class="btn btn-red" onclick="clearData()">–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</button>
</div>

</div>

<script>
/* ------------------ –¢–µ–º–∞ ------------------ */
const THEME_KEY = "cosmozar-theme";

function applyTheme() {
  const theme = localStorage.getItem(THEME_KEY) || "light";
  document.documentElement.setAttribute("data-theme", theme);
}

function toggleTheme() {
  const oldTheme = localStorage.getItem(THEME_KEY) || "light";
  const newTheme = oldTheme === "light" ? "dark" : "light";
  localStorage.setItem(THEME_KEY, newTheme);
  applyTheme();
}

applyTheme();

/* ------------------ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ------------------ */
function sortKitsAsc() {
  allBranchKits[currentBranch].sort((a,b)=> (a.blasterId||0)-(b.blasterId||0));
  saveAllBranchKits();
  loadAllKitsUI();
}

function sortKitsDesc() {
  allBranchKits[currentBranch].sort((a,b)=> (b.blasterId||0)-(a.blasterId||0));
  saveAllBranchKits();
  loadAllKitsUI();
}

/* ------------------ UI –Ω–∞–≤–∏–≥–∞—Ü–∏—è ------------------ */
function showPage(page) {
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
  document.getElementById(page).classList.remove('hidden');
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  const index = ["kits","blasters","players","settings"].indexOf(page);
  document.querySelectorAll('.tab')[index].classList.add('active');
}

function toggleSettingsMenu(){
  document.getElementById("settingsMenu").classList.toggle("hidden");
}

/* ------------------ –•—Ä–∞–Ω–∏–ª–∏—â–µ ------------------ */
let currentBranch = "default";
let allBranchKits = JSON.parse(localStorage.getItem("branchkits")||"{}");
if(!allBranchKits[currentBranch]) allBranchKits[currentBranch]=[];

function saveAllBranchKits(){
  localStorage.setItem("branchkits", JSON.stringify(allBranchKits));
}

/* ------------------ –ö–æ–º–ø–ª–µ–∫—Ç—ã ------------------ */
function loadAllKitsUI(){
  const list = document.getElementById('kitList');
  list.innerHTML="";

  allBranchKits[currentBranch].forEach((k,i)=>{
    const div = document.createElement("div");
    div.innerHTML = `<div class="kit">#${k.blasterId||"?"} ‚Äî ${k.name||"–ë–µ–∑ –∏–º–µ–Ω–∏"}</div>`;
    list.appendChild(div);
  });
}

function createNewKit(){
  allBranchKits[currentBranch].push({blasterId:0,name:"–ù–æ–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Ç"});
  allBranchKits[currentBranch].sort((a,b)=> (a.blasterId||0)-(b.blasterId||0));
  saveAllBranchKits();
  loadAllKitsUI();
}

/* ------------------ –°–±—Ä–æ—Å ------------------ */
function clearData(){
  if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?")){
    localStorage.clear();
    location.reload();
  }
}

loadAllKitsUI();
</script>
</body>
</html>